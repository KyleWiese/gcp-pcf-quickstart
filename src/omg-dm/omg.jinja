resources:
- name: pcfNetwork
  type: base/networks.jinja
  properties:
    region: us-central1

- name: jumpbox
  type: base/jumpbox.jinja
  properties:
    zone: us-central1-b
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)
    subnetworkSelfLink: $(ref.pcfNetwork.mgmtSubnetworkSelfLink)

- name: natA
  type: nat/deployment.jinja
  properties:
    region: us-central1
    zone: us-central1-b
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)
    subnetworkSelfLink: $(ref.pcfNetwork.mgmtSubnetworkSelfLink)

- name: ops_manager
  type: ops_manager/ops_manager.jinja
  properties:
    region: us-central1
    zone: us-central1-b
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)
    subnetworkSelfLink: $(ref.pcfNetwork.mgmtSubnetworkSelfLink)
    projectOwner: {{ properties['projectOwner'] }}

- name: ertHttpRouting
  type: ert/http_routing.jinja
  properties:
    region: us-central1
    zone1: us-central1-b
    zone2: us-central1-c
    zone3: us-central1-f
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)
    sslPrivateKeyPath: ssl/server.key
    sslCertificatePath: ssl/server.crt

- name: ertSshRouting
  type: ert/ssh_routing.jinja
  properties:
    region: us-central1
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)

- name: ertTcpRouting
  type: ert/tcp_routing.jinja
  properties:
    region: us-central1
    networkSelfLink: $(ref.pcfNetwork.networkSelfLink)
    portRange: 1024-65535

- name: ertStorage
  type: ert/storage.jinja

#
# Exported variables
#
- name: omgConfig
  type: runtimeconfig.v1beta1.config
  properties:
    config: omgConfig
    description: Config for resources in OMG Deployment
- name: opsManagerIp
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: opsManagerIp
    text: $(ref.ops_manager.opsManagerIp)
- name: jumpboxName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: jumpboxName
    text: $(ref.jumpbox.vmName)
- name: networkName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: networkName
    text: $(ref.pcfNetwork.networkName)
- name: mgmtSubnetName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: mgmtSubnetName
    text: $(ref.pcfNetwork.mgmtSubnetName)
- name: mgmtSubnetGateway
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: mgmtSubnetGateway
    text: $(ref.pcfNetwork.mgmtSubnetGateway)
- name: mgmtSubnetCIDR
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: mgmtSubnetCIDR
    text: $(ref.pcfNetwork.mgmtSubnetCIDR)
- name: servicesSubnetName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: servicesSubnetName
    text: $(ref.pcfNetwork.servicesSubnetName)
- name: servicesSubnetGateway
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: servicesSubnetGateway
    text: $(ref.pcfNetwork.servicesSubnetGateway)
- name: servicesSubnetCIDR
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: servicesSubnetCIDR
    text: $(ref.pcfNetwork.servicesSubnetCIDR)
- name: ertSubnetName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: ertSubnetName
    text: $(ref.pcfNetwork.ertSubnetName)
- name: ertSubnetGateway
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: ertSubnetGateway
    text: $(ref.pcfNetwork.ertSubnetGateway)
- name: ertSubnetCIDR
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: ertSubnetCIDR
    text: $(ref.pcfNetwork.ertSubnetCIDR)
- name: httpLoadBalancerIP
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: httpLoadBalancerIP
    text: $(ref.ertHttpRouting.httpLoadBalancerIP)
- name: sshTargetPoolName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: sshTargetPoolName
    text: $(ref.ertSshRouting.targetPoolName)
- name: sshLoadBalancerIP
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: sshLoadBalancerIP
    text: $(ref.ertSshRouting.loadBalancerIP)
- name: sshTargetTag
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: sshTargetTag
    text: $(ref.ertSshRouting.targetTag)
- name: tcpTargetPoolName
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: tcpTargetPoolName
    text: $(ref.ertTcpRouting.targetPoolName)
- name: tcpLoadBalancerIP
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: tcpLoadBalancerIP
    text: $(ref.ertTcpRouting.loadBalancerIP)
- name: tcpTargetTag
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: tcpTargetTag
    text: $(ref.ertTcpRouting.targetTag)
- name: tcpPortRange
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: tcpPortRange
    text: $(ref.ertTcpRouting.portRange)
- name: buildpacksBucket
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: buildpacksBucket
    text: $(ref.ertStorage.buildpacksBucket)
- name: dropletsBucket
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: dropletsBucket
    text: $(ref.ertStorage.dropletsBucket)
- name: packagesBucket
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: packagesBucket
    text: $(ref.ertStorage.packagesBucket)
- name: resourcesBucket
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: resourcesBucket
    text: $(ref.ertStorage.resourcesBucket)
- name: directorBucket
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: directorBucket
    text: $(ref.ops_manager.directorBucket)
- name: rootDomain
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: rootDomain
    text: {{ properties['rootDomain'] }}
- name: sslPrivateKey
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: sslPrivateKey
    value: $(ref.ertHttpRouting.sslPrivateKey)
- name: sslCertificate
  type: runtimeconfig.v1beta1.variable
  properties:
    parent: $(ref.omgConfig.name)
    variable: sslCertificate
    value: $(ref.ertHttpRouting.sslCertificate)

